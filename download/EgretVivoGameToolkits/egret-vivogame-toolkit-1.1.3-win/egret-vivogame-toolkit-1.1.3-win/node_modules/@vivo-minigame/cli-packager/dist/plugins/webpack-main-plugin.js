"use strict";var _interopRequireWildcard=require("@babel/runtime-corejs2/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime-corejs2/helpers/interopRequireDefault"),_Object$defineProperty=require("@babel/runtime-corejs2/core-js/object/define-property");_Object$defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _promise=_interopRequireDefault(require("@babel/runtime-corejs2/core-js/promise")),_path=_interopRequireDefault(require("path")),_cliSharedUtils=require("@vivo-minigame/cli-shared-utils"),paths=_interopRequireWildcard(require("../lib/paths"));/**
 * 打出带 main.js 入口的游戏包，适配联盟引擎
 */ // import { LOG_TITLE } from '../lib/constanst'
class ZipMainPlugin{constructor(a){this.options=a}apply(a){const{singlePackage:b,subpackages:c}=this.options;a.hooks.afterEmit.tapPromise("ZipMainPlugin",()=>new _promise.default(a=>{b?(_cliSharedUtils.fs.existsSync(_path.default.resolve(paths.BUILD,"./main.js"))?(0,_cliSharedUtils.warn)("main.js\u4E3A\u5165\u53E3\u6587\u4EF6\uFF0C\u4E0D\u5141\u8BB8\u4F5C\u4E3A\u4E1A\u52A1\u6587\u4EF6\u5F15\u5165\u8FDB\u6765\uFF0C\u5982\u679C\u6E38\u620F\u6709\u62A5\u9519\uFF0C\u8BF7\u4FEE\u6539\u6587\u4EF6\u540D\uFF0C\u91CD\u65B0\u6253\u5305"):_cliSharedUtils.fs.outputFileSync(_path.default.resolve(paths.BUILD,"./main.js"),"require(\"game.js\");","utf8"),a()):(c.forEach(({root:a})=>{const b=_path.default.extname(a);if(""===b)// 如果是目录
// 生成 main.js文件，引入 game.js，作为分包适配联盟api的入口
if(_cliSharedUtils.fs.existsSync(_path.default.resolve(paths.BUILD,a,"./main.js")))// console.warn('main.js为入口文件，不允许作为业务文件引入进来，如果游戏有报错，请修改文件名，重新打包')
throw new Error("main.js\u4E3A\u5B50\u5305\u5165\u53E3\u6587\u4EF6\uFF0C\u4E0D\u5141\u8BB8\u4F5C\u4E3A\u4E1A\u52A1\u6587\u4EF6\u5F15\u5165\uFF0C\u8BF7\u4FEE\u6539\u6587\u4EF6\u540D\uFF0C\u91CD\u65B0\u6253\u5305");else _cliSharedUtils.fs.outputFileSync(_path.default.resolve(paths.BUILD,a,"./main.js"),"require(\"./game.js\");","utf8")}),a())}))}}var _default=ZipMainPlugin;exports.default=_default;